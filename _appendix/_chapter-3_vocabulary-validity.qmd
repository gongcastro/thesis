```{r setup}
library(dplyr)
library(tidyr)
library(readr)
library(patchwork)

time_subset <- c(0.3, 2)

data_summary <- read_csv(here("data", "03-chapter-3", "data", "validity-summary.csv"))
data_time <- read_csv(here("data", "03-chapter-3", "data", "validity-time.csv"))
```

To test the validity of caregivers' estimates of word comprehension in the vocabulary questionnaires, we compared participants' target looking for target words reported as acquired, compared to those reported as not acquired. If parents' responses are accurate, target looking preference should be stronger in for acquired words. We conducted this analysis by computing the logit of the probability of target looking at during the presentation of the target and the distractor pictures for each participant across conditions, and then across participants. In @fig-validity-target, we report the target looking trends in the three groups tested in Chapter 3: English monolinguals in Study 1, Catalan and Spanish monolinguals in Study 2, and Catalan-Spanish bilinguals in Study 3. Monolinguals and bilinguals in Study 2 showed a stronger target preference for target words reported as acquired, compared to words not reported as acquired. The probability of target looking for acquired targets exceeded zero in monolinguals and bilinguals, whereas the probability of target looking for targets not reported as acquired did not exceed zero. These outcomes provide evidence of concurrent validity for the acquisition estimates of families in Study 2. The results from participants in Study 1 show a different patterns, in which participants showed a strong target looking preference for all target words, reported as acquired or not. This indicates that families likely underestimated their children's word comprehension abilities in their vocabulary checklists.

```{r fig-validity-target}
#| label: fig-validity-target
#| fig-cap: "Target fixations for words reported as acquired (red) and for words not reported as acquired (blue) by caregivers in the vocabulary checklists. (A) Time course of fixations 300 ms after the presentation of the target and distractor pictures, until the end of the trials. Lines and intervals indicate the mean and standard error of the mean. (B) Target looking preference, averaged across the trials. Points and intervals indicate the mean and standard error of the mean."
#| fig-height: 8
#| fig-width: 5
#| out-width: 100%
clrs <- c("#004AAD", "#C8102E", "#FF9E1F")

plot_summary <- data_summary |> 
	mutate(lp = factor(lp,
					   levels = c("Monolingual (English)",
					   		   "Monolingual",
					   		   "Bilingual"),
					   labels = c("Study 1: Monolingual",
					   		   "Study 2: Monolingual",
					   		   "Study 3: Bilingual"))) |> 
	select(session_id, lp, .elog, target) |> 
	arrange(session_id, target) |> 
	summarise(.elog_mean = mean(.elog),
			  .elog_sd = sd(.elog),
			  n = n(),
			  .by = c(lp, target)) |> 
	mutate(target = ifelse(target, "Yes", "No"),
		   .elog_se = .elog_sd/sqrt(n),
		   .elog_lower = .elog_mean - .elog_se*1.96,
		   .elog_upper = .elog_mean + .elog_se*1.96) |> 
	ggplot(aes(lp, .elog_mean, 
			   ymin = .elog_lower,
			   ymax = .elog_upper,
			   colour = target)) +
	facet_wrap(~lp, ncol = 1, scales = "free_x") +
	geom_errorbar(width = 0.2,
				  linewidth = 3/4,
				  position = position_dodge(width = 0.5)) +
	geom_point(size = 2,
			   position = position_dodge(width = 0.5)) +
	geom_hline(yintercept = 0,
			   linetype = "dashed") +
	labs(x = "Condition",
		 y = "Logit p(Target looking)", 
		 colour = "Knows the target word") +
	scale_y_continuous(limits = c(-1, 1.5)) +
	theme(panel.grid.major.y = element_line(colour = "grey",
											linetype = "dotted"),
		  axis.title.y = element_blank(),
		  axis.line.x = element_line(),
		  legend.position = "none",
		  axis.text.x = element_blank()) 

plot_time <- data_time |> 
		mutate(lp = factor(lp,
					   levels = c("Monolingual (English)",
					   		   "Monolingual",
					   		   "Bilingual"),
					   labels = c("Study 1: Monolingual",
					   		   "Study 2: Monolingual",
					   		   "Study 3: Bilingual"))) |> 
	select(session_id, lp, timebin, .elog, target) |> 
	arrange(session_id, target) |> 
	summarise(.elog_mean = mean(.elog),
			  .elog_sd = sd(.elog),
			  n = n(),
			  .by = c(lp, target, timebin)) |> 
	mutate(target = ifelse(target, "Yes", "No"),
		   .elog_se = .elog_sd/sqrt(n),
		   .elog_lower = .elog_mean - .elog_se*1.96,
		   .elog_upper = .elog_mean + .elog_se*1.96,
		   timebin = timebin*100) |> 
	ggplot(aes(timebin, .elog_mean,
			   ymin = .elog_lower,
			   ymax = .elog_upper,
			   colour = target,
			   fill = target)) +
	facet_wrap(~lp, scales = "free_x", ncol = 1) +
	geom_line(linewidth = 1/2) +
	geom_ribbon(colour = NA,
				alpha = 1/2) +
	geom_point(size = 1.75) +
	geom_hline(yintercept = 0,
			   linetype = "dashed") +
	labs(x = "Condition",
		 y = "Logit p(Target looking)", 
		 fill = "Knows the target word",
		 colour = "Knows the target word") +
	scale_y_continuous(limits = c(-1, 1.5)) +
	scale_x_continuous(labels = \(x) format(x, big.mark = ",")) +
	theme(legend.position = "top",
		  panel.grid.major.y = element_line(colour = "grey",
		  								  linetype = "dotted")) 

(plot_time | plot_summary) +
	plot_layout(ncol = 2,
				widths = c(0.7, 0.3)) &
	plot_annotation(tag_levels = "A") &
	scale_color_manual(values = clrs) &
	scale_fill_manual(values = clrs) &
	theme(panel.grid.minor = element_blank(),
		  panel.grid.major.x = element_blank())
```

